{% extends 'base.html' %}
{% load static %}

{% block title %}{{ profile_user.username }} - TechBlog{% endblock %}

{% block content %}
<div class="container">
    <div class="profile-page">
        <!-- –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-header">
            <div class="profile-avatar-section">
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="{{ profile_user.username }}" class="profile-avatar">
                {% else %}
                    <div class="profile-avatar-placeholder">
                        {{ profile_user.username.0|upper }}
                    </div>
                {% endif %}
            </div>
            
            <div class="profile-info">
                <div class="profile-main">
                    <h1 class="profile-username">{{ profile_user.username }}</h1>
                    {% if profile_user.first_name or profile_user.last_name %}
                        <p class="profile-fullname">{{ profile_user.first_name }} {{ profile_user.last_name }}</p>
                    {% endif %}
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-value">{{ profile_user.posts.count }}</span>
                            <span class="stat-label">–ü–æ—Å—Ç–æ–≤</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">{{ profile.get_followers_count }}</span>
                            <span class="stat-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">{{ profile.get_total_likes }}</span>
                            <span class="stat-label">–õ–∞–π–∫–æ–≤</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-actions">
                    {% if user == profile_user %}
                        <a href="{% url 'users:settings' %}" class="btn btn-primary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                    {% elif user.is_authenticated %}
                        <button class="btn btn-primary subscribe-btn {% if is_subscribed %}subscribed{% endif %}"
                                data-username="{{ profile_user.username }}"
                                id="subscribeBtn">
                            <span class="subscribe-text">
                                {% if is_subscribed %}–û—Ç–ø–∏—Å–∞—Ç—å—Å—è{% else %}–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è{% endif %}
                            </span>
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="profile-details">
            {% if profile.bio %}
                <div class="profile-bio">
                    <h3>–û —Å–µ–±–µ</h3>
                    <p>{{ profile.bio|linebreaks }}</p>
                </div>
            {% endif %}
            
            <div class="profile-meta">
                {% if profile.location %}
                    <div class="meta-item">
                        <span class="meta-icon">üìç</span>
                        <span>{{ profile.location }}</span>
                    </div>
                {% endif %}
                {% if profile.website %}
                    <div class="meta-item">
                        <span class="meta-icon">üîó</span>
                        <a href="{{ profile.website }}" target="_blank" rel="noopener noreferrer">
                            {{ profile.website }}
                        </a>
                    </div>
                {% endif %}
                <div class="meta-item">
                    <span class="meta-icon">üìÖ</span>
                    <span>–ù–∞ —Å–∞–π—Ç–µ —Å {{ profile_user.date_joined|date:"F Y" }}</span>
                </div>
            </div>
        </div>

        <!-- –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="profile-posts">
            <h2 class="section-title">–ü–æ—Å—Ç—ã –∞–≤—Ç–æ—Ä–∞</h2>
            
            {% if page_obj %}
                <div class="posts-list">
                    {% for post in page_obj %}
                        <article class="post-item">
                            <div class="post-item-header">
                                <span class="post-date">{{ post.created_at|date:"d F Y" }}</span>
                            </div>
                            
                            <div class="post-item-body">
                                <h3 class="post-title">
                                    <a href="{% url 'blog:post_detail' post.pk %}">{{ post.title }}</a>
                                </h3>
                                <p class="post-excerpt">{{ post.content|truncatewords:50|striptags }}</p>
                                
                                {% if post.tags.all %}
                                    <div class="post-tags">
                                        {% for tag in post.tags.all %}
                                            <a href="{% url 'blog:tag_posts' tag.slug %}" class="tag-mini">{{ tag.name }}</a>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="post-item-footer">
                                <div class="post-stats">
                                    <span class="stat">
                                        <span class="stat-icon">üëÅ</span> {{ post.views }}
                                    </span>
                                    <span class="stat">
                                        <span class="stat-icon">‚ù§Ô∏è</span> {{ post.total_likes }}
                                    </span>
                                    <span class="stat">
                                        <span class="stat-icon">üí¨</span> {{ post.comments.count }}
                                    </span>
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>

                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                {% if page_obj.has_other_pages %}
                    <div class="pagination">
                        {% if page_obj.has_previous %}
                            <a href="?page={{ page_obj.previous_page_number }}" class="pagination-btn">‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                        {% endif %}
                        
                        <span class="pagination-info">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                        </span>
                        
                        {% if page_obj.has_next %}
                            <a href="?page={{ page_obj.next_page_number }}" class="pagination-btn">–°–ª–µ–¥—É—é—â–∞—è ‚Ä∫</a>
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/subscribe.js' %}"></script>
{% endblock %}

